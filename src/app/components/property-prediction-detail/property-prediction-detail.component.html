<app-job-tab [tab]="currentPage" (onTabChange)="currentPage = $event"></app-job-tab>

@if (currentPage === 'result') {
<div class="flex flex-col gap-4 max-w-content-xl w-full px-4">
  <div class="flex items-center justify-between pt-4">
    <div class="flex gap-2 items-center">
      <button type="button" title="Back to All Results"
        class="border border-solid border-[#DEE2E6] rounded-sm px-2 py-1 flex items-center gap-2 bg-[#f8f9fa]"
        (click)="backToSearch()">
        <i class="pi pi-arrow-left"></i>
        <span>Back to All Results</span>
      </button>
      @switch (algorithm) {
      @case ('dlkcat') {
      <h5 class="font-bold mt-0">DLKcat Results</h5>
      }
      @case ('unikp') {
      <h5 class="font-bold mt-0">UniKP Results</h5>
      }
      @case ('catpred') {
      <h5 class="font-bold mt-0">CatPred Results</h5>
      }
      }
      <button type="button" title="copy job id" class="border-none cursor-pointer">
        <i class="pi pi-link" (click)="copyAndPasteURL()"></i>
      </button>
    </div>
    <div class="flex items-center gap-2">

      <div id="btn-export" class="flex flex-col justify-center">
        <!-- <p-button label="Export" icon="pi pi-download" (onClick)="menu.toggle($event)"></p-button>
          <p-tieredMenu #menu [model]="exportOptions" [popup]="true" /> -->
      </div>
    </div>
  </div>

  <p-panel>
    <ng-template pTemplate="header">
      <span class="grow">Predictions</span>
    </ng-template>

    @if (result.status === 'loading') {
    <!-- <div class="flex gap-2 p-2">
          <p-skeleton shape="rectangle" width="217px" height="217px"></p-skeleton>
          <div class="flex flex-col gap-4 grow border-l border-solid border-[#DEE2E6] pl-2">
            <div class="flex flex-col gap-4">
              <div class="flex justify-between">
                <p-skeleton width="100px" height="1.5rem"></p-skeleton>
                <p-skeleton width="200px" height="1.5rem"></p-skeleton>
              </div>
              <div class="flex justify-between">
                <p-skeleton width="100px" height="1.5rem"></p-skeleton>
                <p-skeleton width="200px" height="1.5rem"></p-skeleton>
              </div>
              <div class="flex justify-between">
                <p-skeleton width="150px" height="1.5rem"></p-skeleton>
                <p-skeleton width="100px" height="1.5rem"></p-skeleton>
              </div>
              <hr>
              <div class="flex flex-col gap-2">
                <p-skeleton width="300px" height="1.5rem"></p-skeleton>
                <p-skeleton width="100%" height="3rem"></p-skeleton>
              </div>
            </div>
          </div>
        </div> -->
    }

    <!-- @else if (jobInfo) { -->
    @switch (algorithm) {
    @case ('dlkcat') {
    <div class="flex flex-col gap-2 p-2">
      <div class="flex flex-col gap-4 w-full p-2">
        <span class="font-semibold">Input</span>
        <div class="flex flex-col gap-4">
          <div class="flex justify-between">
            <span class="leading-sm text-[#495057]">Enzyme Sequence (FASTA)</span>
            <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{
              jobInfo.enzyme }}</span>
          </div>
          <div class="flex justify-between">
            <span class="leading-sm text-[#495057]">Substrate</span>
            <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{
              jobInfo.substrate }}</span>
          </div>
          <app-molecule-image #molecule2d
            class="w-full h-full rounded-md border border-solid border-[#DEE2E6] p-2 flex items-center justify-center"
            [smiles]="jobInfo.substrate" [width]="200" [height]="150"
          ></app-molecule-image>
        </div>
      </div>
      <div class="flex flex-col gap-2 w-full p-2">
        <span class="font-semibold">Results</span>
        <div class="flex justify-between max-w-[200px]">
          <span class="leading-sm text-[#495057]"><span class="italic">k</span><sub>cat</sub>(1/s)</span>
          <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{ result.data.kcat }}</span>
        </div>

        <span class="font-semibold mt-6">Experimental Context</span>
        <span class="italic text-[#6C757D] text-sm">Understand your prediction results in the context of Open Enzyme Database's experimental data.</span>
        
        <div class="bg-[#F7F8F9] rounded-sm p-2 flex justify-center gap-2">
          <div class="flex flex-col gap-1 grow">
            <span class="leading-sm text-[#495057] font-semibold ml-2"><span class="italic">k</span><sub>cat</sub></span>
            <app-density-plot
              class="grow"
              [data]="(kcat$ | async) || []"
              scaleType="log"
              [bandwidth]="0.05"
              [highlightValue]="result.data.kcat"
            ></app-density-plot>
          </div>
        </div>
      </div>
    </div>
  }
  @case ('unikp') {
    <div class="flex flex-col gap-2 p-2">
      <div class="flex flex-col gap-4 w-full p-2">
        <span class="font-semibold">Input</span>
        <div class="flex flex-col gap-4">
          <div class="flex justify-between">
            <span class="leading-sm text-[#495057]">Enzyme Sequence (FASTA)</span>
            <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{
              jobInfo.enzyme }}</span>
          </div>
          <div class="flex justify-between">
            <span class="leading-sm text-[#495057]">Substrate</span>
            <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{
              jobInfo.substrate }}</span>
          </div>
          <app-molecule-image #molecule2d
            class="w-full h-full rounded-md border border-solid border-[#DEE2E6] p-2 flex items-center justify-center"
            [smiles]="jobInfo.substrate" [width]="200" [height]="150"
          ></app-molecule-image>
        </div>
      </div>
      <hr>
      <div class="flex flex-col gap-2 w-full p-2">
        <span class="font-semibold">Results</span>
        <div class="flex justify-between max-w-[200px]">
          <span class="leading-sm text-[#495057]"><span class="italic">k</span><sub>cat</sub>(1/s)</span>
          <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{ result.data.kcat }}</span>
        </div>

        <span class="font-semibold mt-6">Experimental Context</span>
        <span class="italic text-[#6C757D] text-sm">Understand your prediction results in the context of Open Enzyme Database's experimental data.</span>
        
        <div class="bg-[#F7F8F9] rounded-sm p-2 flex justify-center gap-2">
          <div class="flex flex-col gap-1 grow">
            <span class="leading-sm text-[#495057] font-semibold ml-2"><span class="italic">k</span><sub>cat</sub></span>
            <app-density-plot
              class="grow"
              [data]="(kcat$ | async) || []"
              scaleType="log"
              [bandwidth]="0.05"
              [highlightValue]="result.data.kcat"
            ></app-density-plot>
          </div>
          <div class="flex flex-col gap-1 grow">
            <span class="leading-sm text-[#495057] font-semibold ml-2"><span class="italic">K</span><sub>m</sub></span>
            <app-density-plot
              class="grow"
              [data]="(km$ | async) || []"
              scaleType="log"
              [bandwidth]="0.05"
              [highlightValue]="result.data.km"
            ></app-density-plot>
          </div>
          <div class="flex flex-col gap-1 grow">
            <span><span class="leading-sm text-[#495057] font-semibold ml-2"><span class="italic">k</span><sub>cat</sub></span>/<span class="leading-sm text-[#495057] font-semibold"><span class="italic">K</span><sub>m</sub></span></span>
            <app-density-plot
              class="grow"
              [data]="(kcatKm$ | async) || []"
              scaleType="log"
              [bandwidth]="0.05"
              [highlightValue]="result.data.kcatKm"
            ></app-density-plot>
          </div>
        </div>
      </div>
    </div>
  }
  @case ('catpred') {
    <div class="flex flex-col gap-2 p-2">
      <div class="flex flex-col gap-4 w-full p-2">
        <span class="font-semibold">Input</span>
        <div class="flex flex-col gap-4">
          <div class="flex justify-between">
            <span class="leading-sm text-[#495057]">Enzyme Sequence (FASTA)</span>
            <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{
              jobInfo.enzyme }}</span>
          </div>
          <div class="flex justify-between">
            <span class="leading-sm text-[#495057]">Substrate</span>
            <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{
              jobInfo.substrate }}</span>
          </div>
          <app-molecule-image #molecule2d
            class="w-full h-full rounded-md border border-solid border-[#DEE2E6] p-2 flex items-center justify-center"
            [smiles]="jobInfo.substrate" [width]="200" [height]="150"
          ></app-molecule-image>
        </div>
      </div>
      <hr>
      <div class="flex flex-col gap-2 w-full p-2">
        <span class="font-semibold">Results</span>
        <div class="flex justify-between max-w-[200px]">
          <span class="leading-sm text-[#495057]"><span class="italic">k</span><sub>cat</sub>(1/s)</span>
          <span class="font-semibold text-end leading-base inline-block max-w-[200px] break-words">{{ result.data.kcat }}</span>
        </div>

        <span class="font-semibold mt-6">Experimental Context</span>
        <span class="italic text-[#6C757D] text-sm">Understand your prediction results in the context of Open Enzyme Database's experimental data.</span>
        
        <div class="bg-[#F7F8F9] rounded-sm p-2 flex justify-center gap-2">
          <div class="flex flex-col gap-1 grow">
            <span class="leading-sm text-[#495057] font-semibold ml-2"><span class="italic">k</span><sub>cat</sub></span>
            <app-density-plot
              class="grow"
              [data]="(kcat$ | async) || []"
              scaleType="log"
              [bandwidth]="0.05"
              [highlightValue]="result.data.kcat"
            ></app-density-plot>
          </div>
          <div class="flex flex-col gap-1 grow">
            <span class="leading-sm text-[#495057] font-semibold ml-2"><span class="italic">K</span><sub>m</sub></span>
            <app-density-plot
              class="grow"
              [data]="(km$ | async) || []"
              scaleType="log"
              [bandwidth]="0.05"
              [highlightValue]="result.data.km"
            ></app-density-plot>
          </div>
        </div>
      </div>
    </div>
  }
  }
    <!-- } -->
  </p-panel>

</div>
} @else {
<!-- <app-property-prediction [formValue]="jobInfo" [showJobTab]="false"></app-property-prediction> -->
}